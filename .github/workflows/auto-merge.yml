name: Auto Merge PRs for Specific File

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  auto-merge:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Check if specific file is changed
      run: |
        # Define the specific file you're watching
        FILE="assets/js/contributors.js"

        # Get the list of changed files in the PR
        CHANGED_FILES=$(git diff --name-only ${{ github.event.before }} ${{ github.sha }})

        echo "$CHANGED_FILES"
        
        # Check if the specific file is in the list of changed files
        if echo "$CHANGED_FILES" | grep -q "$FILE"; then
          echo "Specific file $FILE has been changed."
          echo "Merging the pull request..."
          echo "::set-output name=should-merge::true"
        else
          echo "Specific file $FILE has NOT been changed."
          echo "::set-output name=should-merge::false"
        fi
      id: file-check

    - name: Merge the PR if the file has been changed
      if: steps.file-check.outputs.should-merge == 'true'
      run: |
        gh pr merge ${{ github.event.pull_request.number }} --auto --squash
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
